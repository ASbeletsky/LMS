@using LMS.Dto
@model IEnumerable<TestSessionDTO>

@{
    ViewData["Title"] = "List";
}

<p>
    <a asp-action="Create">Create New</a>
</p>
@if (Model.Any())
{
    <div id='calendar'></div>
}
else
{
    <center>No items found</center>
}

@Html.Partial("Dialog", new DialogViewModel("deleteModal")
{
    Content = "Are you sure that you want to delete this template?",
    SubmitAction = "Delete",
    SubmitController = "Task"
})

@if (Model.Any())
{
    @section scripts
    { 
    <script>
            var date = new Date();
            var d = date.getDate();
            var m = date.getMonth();
            var y = date.getFullYear();

            $(function () {
                var calendar = $('#calendar').fullCalendar({
                    header: {
                        left: 'title',
                        center: 'agendaDay,agendaWeek,month',
                        right: 'prev,next today'
                    },
                    editable: false,
                    firstDay: 1, //  1(Monday)
                    selectable: true,
                    allDaySlot: true,
                    selectHelper: true,
                    eventClick: function (calEvent, jsEvent, view) {
                        alert('Event: ' + calEvent.title);
                        $(this).css('border-color', 'red');
                    },
                    select: function (start, end, allDay) {
                        //location.href = '@Url.Action("Create")'
                        var title = prompt('Event Title:');
                        if (title) {
                            calendar.fullCalendar('renderEvent',
                                {
                                    title: title,
                                    start: start,
                                    end: end,
                                    allDay: allDay
                                },
                                true // make the event "stick"
                            );
                        }
                        calendar.fullCalendar('unselect');
                    },
                    droppable: false,
                    events: [
                        @foreach (var session in Model)
                        {
                            @:{
                            @:    id: @session.Id,
                            @:    title: "@session.Title",
                            @:    start: new Date(@session.StartTime.ToUnixTimeMilliseconds()),
                            @:    end: new Date(@session.EndTime.ToUnixTimeMilliseconds()),
                            @:    allDay: false,
                            @:    className: 'info'
                            @:},
                        }
                    ]
                })
            });
    </script>
    }
}